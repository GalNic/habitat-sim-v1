<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Home in Space — V1.3.2</title>
  <link rel="icon" href="./favicon.ico.png">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
<header>
  <div class="title">Your Home in Space — <span class="pill">V1.3.2</span></div>
  <div class="sep"></div>
  <label>Environment:
    <select id="envSel">
      <option value="moon">Moon</option>
      <option value="mars">Mars</option>
    </select>
  </label>
  <label>Crew:
    <select id="crewSel">
      <option>1</option><option selected>2</option><option>3</option><option>4</option>
      <option>5</option><option>6</option><option>7</option><option>8</option>
    </select>
  </label>
  <button id="btnGuide">Module Guide</button>
  <button id="btnUndo">Undo</button>
  <button id="btnRedo">Redo</button>
  <button id="btnReset">Reset Layout</button>
  <button id="btnSim" class="warn">Simulate Life</button>
  <button id="btnSave">Save (JSON)</button>
  <input id="loadFile" type="file" accept=".json" hidden>
  <button id="btnLoad">Load (JSON)</button>
</header>

<div class="wrap">
  <!-- Left -->
  <aside class="panel modules">
    <h3>Modules</h3>
    <div class="hint">Click to insert (centered on active view/floor)</div>
    <div id="modList"></div>
    <hr />
    <h3>Shell</h3>
    <div class="hintSmall">Geometry: <b>Cylinder + hemispherical caps</b></div>
    <div class="kv"><div>Radius (m)</div><input id="inpR" type="number" value="5" step="0.1"></div>
    <div class="kv"><div>Cyl. length (m)</div><input id="inpL" type="number" value="12" step="0.1"></div>
    <div class="kv"><div>Floors (N)</div><input id="inpFloors" type="number" value="3" min="1" max="8"></div>
    <div class="kv"><div>Inter-floor gap (m)</div><input id="inpGap" type="number" value="2.5" step="0.1"></div>
    <button id="btnShellApply" class="btn">Apply</button>
  </aside>

  <!-- Center -->
  <main class="canvas-wrap panel">
    <div class="rowbar">
      <div class="tabs views">
        <label>View:
          <select id="viewSel">
            <option value="top">Top — XY Plane</option>
            <option value="front">Front — XZ Plane</option>
            <option value="side">Side — YZ Plane</option>
          </select>
        </label>
      </div>
      <div class="tabs floors">
        <label>Floor:
          <select id="floorSel"></select>
        </label>
      </div>
    </div>
    <canvas id="cv" width="1280" height="640"></canvas>
    <div id="floorBadge" class="pill badge">Active floor: 1</div>
    <div class="kbd">Shortcuts: Arrows=move 0.1 m (Shift=1 m) · R=rotate 15° · Del=delete</div>
  </main>

  <!-- Right -->
  <aside class="panel props">
    <h3>Properties</h3>
    <div id="propBox"><div class="hint">Select a module…</div></div>

    <div class="score">
      <div><b>Score & Status</b></div>
      <div id="scoreBox">
        <div>Collisions: <span id="scColl">0.00</span></div>
        <div>Adjacency: <span id="scAdj">1.00</span></div>
        <div>NHV efficiency: —</div>
        <div>Total mass (kg): <span id="scMass">0</span></div>
        <div class="mt"><b>Design (0–100):</b> <span id="scoreDesign">0.0</span></div>
        <div>Survival (0–1): <span id="scoreSurv">0.00</span></div>
        <div class="mt"><b>Effective score:</b> <span id="scoreFinal">0.0</span></div>
      </div>
      <button id="btnScoreDetail" class="btn secondary mt">Show calc detail</button>
    </div>
  </aside>
</div>

<!-- Guide Modal -->
<div id="guideModal" class="modal" aria-hidden="true">
  <div class="card">
    <div class="cardhead">
      <h2>Sizing & Survival Guide</h2>
      <button id="closeGuide" class="btn secondary">Close ✕</button>
    </div>
    <div class="taps">
      <button data-t="a" class="tap">A) Guide</button>
      <button data-t="b" class="tap active">B) Reference table</button>
      <button data-t="c" class="tap">C) Sources</button>
    </div>
    <div id="tabA" style="display:none">
      <p>Nominal capacities per module (crew per module). With crew size <b>N</b> the minimum recommendation is computed. You can edit and apply.</p>
    </div>
    <div id="tabB">
      <table id="capTable">
        <thead>
          <tr>
            <th>Module (app)</th>
            <th>Base parameter</th>
            <th>Nominal capacity<br><small>(crew per module)</small></th>
            <th>Recommendation<br><small>for N=<span id="capN">2</span></small></th>
            <th>Influence</th>
            <th>Rule of thumb</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="rowbtn">
        <button id="btnApplyCaps" class="btn ok">Apply recommendations</button>
        <button id="btnResetCaps" class="btn secondary">Reset capacities</button>
      </div>
    </div>
    <div id="tabC" style="display:none">
      <ul><li>Indicative values based on NASA docs for habitat layouts/functions (SH/TH/PCM).</li></ul>
    </div>
  </div>
</div>

<!-- Simulation Modal -->
<div id="simModal" class="modal" aria-hidden="true">
  <div class="card">
    <div class="cardhead">
      <h2>Life Simulation — Metrics</h2>
      <button id="closeSim" class="btn secondary">Close ✕</button>
    </div>
    <div id="simContent"></div>
  </div>
</div>

<script defer src="./app.js"></script>
</body>
</html>
