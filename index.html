<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Home in Space — V1.3.2</title>
  <link rel="icon" href="./favicon.ico.png">
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
<header>
  <div class="title">Your Home in Space — <span class="pill">V1.3.2</span></div>
  <div class="sep"></div>
  <label>Entorno:
    <select id="envSel">
      <option value="moon">Moon</option>
      <option value="mars">Mars</option>
    </select>
  </label>
  <label>Tripulación (N):
    <input id="crewN" type="number" min="1" max="24" value="2" style="width:72px">
  </label>
  <button id="btnGuide">Guía (módulos)</button>
  <button id="btnUndo">Deshacer</button>
  <button id="btnRedo">Rehacer</button>
  <button id="btnReset">Reiniciar Layout</button>
  <button id="btnSim" class="warn">Simular Vida</button>
  <button id="btnSave">Guardar (JSON)</button>
  <input id="loadFile" type="file" accept=".json" hidden>
  <button id="btnLoad">Cargar (JSON)</button>
</header>

<div class="wrap">
  <!-- Izquierda -->
  <aside class="panel modules">
    <h3>Módulos</h3>
    <div class="hint">Click para insertar (se centra en vista/piso activo)</div>
    <div id="modList"></div>
    <hr />
    <h3>Cascarón</h3>
    <div class="hintSmall">Geometría: <b>Cilindro + tapas hemisféricas</b></div>
    <div class="kv"><div>Radio (m)</div><input id="inpR" type="number" value="5" step="0.1"></div>
    <div class="kv"><div>Longitud cil. (m)</div><input id="inpL" type="number" value="12" step="0.1"></div>
    <div class="kv"><div>Pisos (N)</div><input id="inpFloors" type="number" value="3" min="1" max="8"></div>
    <div class="kv"><div>Separación entre pisos (m)</div><input id="inpGap" type="number" value="2.5" step="0.1"></div>
    <button id="btnShellApply" class="btn">Aplicar</button>
  </aside>

  <!-- Centro -->
  <main class="canvas-wrap panel">
    <div class="rowbar">
      <div class="tabs views">
        <button data-v="top"   class="tab active">Vista Superior — <b>Plano XY</b></button>
        <button data-v="front" class="tab">Vista Frontal — <b>Plano XZ</b></button>
        <button data-v="side"  class="tab">Vista Lateral — <b>Plano YZ</b></button>
      </div>
      <div class="tabs floors">
        <span class="lbl">Piso:</span>
        <button data-f="1" class="tab active">1</button>
        <button data-f="2" class="tab">2</button>
        <button data-f="3" class="tab">3</button>
      </div>
    </div>
    <canvas id="cv" width="1280" height="640"></canvas>
    <div id="floorBadge" class="pill badge">Piso activo: 1</div>
    <div class="kbd">Atajos: Flechas= mover 0.1 m (Shift=1 m) · R=rotar 15°</div>
  </main>

  <!-- Derecha -->
  <aside class="panel props">
    <h3>Propiedades</h3>
    <div id="propBox"><div class="hint">Seleccioná un módulo…</div></div>

    <div class="score">
      <div><b>Score & Estado</b></div>
      <div id="scoreBox">
        <div>Colisiones: <span id="scColl">0.00</span></div>
        <div>Adyacencias: <span id="scAdj">1.00</span></div>
        <div>NHV eficiencia: —</div>
        <div>Masa total (kg): <span id="scMass">0</span></div>
        <div class="mt"><b>Diseño (0–100):</b> <span id="scoreDesign">0.0</span></div>
        <div>Supervivencia (0–1): <span id="scoreSurv">0.00</span></div>
        <div class="mt"><b>Score efectivo:</b> <span id="scoreFinal">0.0</span></div>
      </div>
      <button id="btnScoreDetail" class="btn secondary mt">Ver detalle de cálculo</button>
    </div>
  </aside>
</div>

<!-- Modal Guía -->
<div id="guideModal" class="modal" aria-hidden="true">
  <div class="card">
    <div class="cardhead">
      <h2>Guía de dimensionamiento y supervivencia</h2>
      <button id="closeGuide" class="btn secondary">Cerrar ✕</button>
    </div>
    <div class="taps">
      <button data-t="a" class="tap">A) Guía</button>
      <button data-t="b" class="tap active">B) Tabla de referencia</button>
      <button data-t="c" class="tap">C) Fuentes</button>
    </div>
    <div id="tabA" style="display:none">
      <p>Capacidades nominales precargadas por módulo (tripulantes por módulo). Con el valor <b>N</b> de tripulación se calcula la recomendación mínima. Podés editar y aplicar.</p>
    </div>
    <div id="tabB">
      <table id="capTable">
        <thead>
          <tr>
            <th>Módulo (app)</th>
            <th>Parámetro base</th>
            <th>Capacidad nominal<br><small>(N tripulantes por módulo)</small></th>
            <th>Recomendación<br><small>para N=<span id="capN">2</span></small></th>
            <th>Influencia</th>
            <th>Regla orientativa</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="rowbtn">
        <button id="btnApplyCaps" class="btn ok">Aplicar recomendaciones</button>
        <button id="btnResetCaps" class="btn secondary">Restablecer capacidades</button>
      </div>
    </div>
    <div id="tabC" style="display:none">
      <ul>
        <li>Valores orientativos extraídos de documentación NASA para layouts/funciones de hábitat (SH/TH/PCM).</li>
      </ul>
    </div>
  </div>
</div>

<!-- Modal Simulación -->
<div id="simModal" class="modal" aria-hidden="true">
  <div class="card">
    <div class="cardhead">
      <h2>Simulación de vida — Métricas</h2>
      <button id="closeSim" class="btn secondary">Cerrar ✕</button>
    </div>
    <div id="simContent">
      <!-- se llena por JS -->
    </div>
  </div>
</div>

<script defer src="./app.js"></script>
</body>
</html>
